<!DOCTYPE html>
<html>
<head>
	<title>GGXRD-Animation-Rip-Aid</title>
	<style type="text/css">
		input{
			display: block;
		}
		* {
			font-size: 1em;
			font-family: sans-serif;
		}
		label {
			font-size: 1.2em;
		}
		input, button {
			width: 100%;
			margin: 0.2em 0;
			padding: 0.1em;
			box-sizing: border-box;
		}
	</style>
</head>
<body>
<label>Character
	<input type=text id="character">
</label>
<button id='start'>start</button>
<script type="text/javascript">
	const ipc = require('electron').ipcRenderer;
	const net = require('net');
	const config = require('../../config');
	const client = net.createConnection({ port: config.port }, () => {
		console.log('connected to server!');
	});
	let startToggle = true;

	ipc.send('ready');
	
	client.on('data', (data) => {
		data = JSON.parse(data)
		console.log(data);
		if (data.event === 'stop'){
			startToggle = true;
			document.getElementById('start').disabled = false;
		}
	});

	client.write = (function(write){
		return function (data){
			if (typeof data === 'object'){
				data = JSON.stringify(data);
			}
			write.apply(this, arguments)
		}
	})(client.write);

	function start(e){
		if (startToggle){
			startToggle = false;
			e.target.disabled = true;
			client.write({
				event: 'start',
				character: document.getElementById('character').value
			})
		}
	};

	document.getElementById('start').onclick = start;

	client.on('end', () => {
		console.log('disconnected from server');
	});

    ipc.on('start', () => {
    	let e = {
    		target: document.getElementById('start')
    	}
    	start(e);
    });
</script>
</body>
</html>